<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0/dist/tf.min.js"></script>
</head>
<body>

  <h1>Modelo: y = 2x + 6</h1>
  <p id="status">Entrenando modelo...</p>

  <input type="number" id="xInput" placeholder="Ingresa un valor para X" disabled />
  <button onclick="predecir()" disabled id="btnPredecir">Predecir Y</button>
  <p id="resultado"></p>

  <script>
    // 1. Crear un modelo secuencial (lineal simple)
    const model = tf.sequential();

    // 2. Agregar una capa densa (una neurona, una entrada)
    model.add(tf.layers.dense({ inputShape: [1], units: 1 }));

    // 3. Compilar el modelo con el optimizador SGD y función de pérdida
    model.compile({
      optimizer: 'sgd', // Gradiente descendiente estocástico
      loss: 'meanSquaredError' // Error cuadrático medio
    });

    // 4. Crear los tensores de entrada (valores de X)
    const xs = tf.tensor2d([-6, -5, -4, -3, -2, -1, 0, 1, 2], [9, 1]);

    // 5. Crear los tensores de salida (valores de Y = 2x + 6)
    const ys = tf.tensor2d([
      -6*2+6,
      -5*2+6,
      -4*2+6,
      -3*2+6,
      -2*2+6,
      -1*2+6,
      0*2+6,
      1*2+6,
      2*2+6
    ], [9, 1]);

    // 6. Función asíncrona para entrenar el modelo
    async function entrenarModelo() {
      // Entrenar durante 350 épocas
      await model.fit(xs, ys, {
        epochs: 350,
        callbacks: {
          // Opcional: mostrar mensaje cada 50 épocas
          onEpochEnd: (epoch, logs) => {
            if (epoch % 50 === 0) {
              console.log(`Época ${epoch}: pérdida = ${logs.loss}`);
            }
          },
          // Cuando termina el entrenamiento
          onTrainEnd: () => {
            document.getElementById('status').innerText = '✅ Modelo entrenado y listo para usar.';
            document.getElementById('xInput').disabled = false;       // Habilita input
            document.getElementById('btnPredecir').disabled = false;  // Habilita botón
          }
        }
      });
    }

    // 7. Llamar a la función para comenzar a entrenar
    entrenarModelo();

    // 8. Función para predecir un valor
    function predecir() {
      // Obtener valor ingresado por el usuario
      const x = parseFloat(document.getElementById('xInput').value);

      // Verificar si es un número válido
      if (isNaN(x)) {
        alert("Por favor ingresa un número válido.");
        return;
      }

      // Crear un tensor con ese número
      const inputTensor = tf.tensor2d([x], [1, 1]);

      // Usar el modelo entrenado para predecir
      const resultado = model.predict(inputTensor);

      // Convertir el resultado a un array y mostrarlo
      resultado.array().then(values => {
        document.getElementById('resultado').innerText = `Predicción: y = ${values[0][0].toFixed(2)}`;
      });
    }
  </script>

</body>
</html>
